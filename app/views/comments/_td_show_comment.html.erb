<% unless @comment.subject.nil? || @comment.subject.empty? %><h3 class="text-default"><strong><%= @comment.subject %></strong></h3><% end %>
<% unless @comment.tag.nil? or @comment.tag.empty? %>
<p class="text-primary">轉錄自 <a class="label label-primary" target="_blank" href=<%= @comment.tag_url.nil? ? "#" : @comment.tag_url %>><%= @comment.tag %></a></p>
<% end %>
<%=  auto_link(simple_format(sanitize @comment.body, tags: %w(a p br)), :all, :target => '_blank') %>

<div class="row">
	<div class="col-xs-8">
		<% if session[:user_id].nil? or @user.is_robot? %>
		<span class="label label-success"><i class="fa fa-thumbs-up fa-fw"></i> <%= @comment.likes.count %></span>
		<span class="label label-danger"><i class="fa fa-thumbs-down fa-fw"></i> <%= @comment.dislikes.count %></span>
		<% else %>
		<% if @proxy.approvals.find(@comment.id) %>
		<span class="like_label_<%= @comment.id %>"><a title="收回讚" class="label label-success" href="<%= neutral_comment_path(@comment) %>" data-remote="true"><i class="fa fa-thumbs-up fa-fw"></i> <%= @comment.likes.count %></a></span>
		<% else %>
		<span class="like_label_<%= @comment.id %>"><a title="讚！" class="label label-success" href="<%= like_comment_path(@comment) %>" data-remote="true"><i class="fa fa-thumbs-o-up fa-fw"></i> <%= @comment.likes.count %></a></span>
		<% end %>
		<% if @proxy.disapprovals.find(@comment.id) %>
		<span class="dislike_label_<%= @comment.id %>"><a title="收回爛" class="label label-danger" href="<%= neutral_comment_path(@comment) %>" data-remote="true"><i class="fa fa-thumbs-down fa-fw"></i> <%= @comment.dislikes.count %></a></span>
		<% else %>
		<span class="dislike_label_<%= @comment.id %>"><a title="爛！" class="label label-danger" href="<%= dislike_comment_path(@comment) %>" data-remote="true"><i class="fa fa-thumbs-o-down fa-fw"></i> <%= @comment.dislikes.count %></a></span>
		<% end %>
		<% end %>
		<a class="label label-primary" href="/<%= @topic.permalink%>/comment_<%= @comment.id %>">評論完整頁面</a>
		<a title="分享到Facebook" href="https://www.facebook.com/sharer/sharer.php?s=100&p[url]=http://platoforum.herokuapp.com/<%= @topic.permalink%>/comment_<%= @comment.id %>" class="label label-primary" onclick="window.open(this.href, '分享到Facebook',
'left=20,top=20,width=700,height=500,toolbar=1,resizable=0'); return false;"><i class="fa fa-share"></i> facebook</a>
	</div>
	<div class="col-xs-4">
		<p class="text-primary" align="right">
			<%=@comment.owner.display_name%><% if (@comment.owner == @proxy)%>（你）<%end%><br>
			發表於 <%= @comment.display_time_detailed %></p>
		</div>
	</div>
</div>
<hr>
<div class="row">
	  <div class="col-md-6">
    <div class="well well-sm">
      <h4 align="center" class="text-muted">評論回應的對象</h4>
      <% @replying = @comment.supporting + @comment.opposing %>

      <div class="panel-body">
            <table class="table table-striped table-hover table-well">
              <tbody>
                <% @replying.sort!{|b,a| a.likes.count <=> b.likes.count}.first(10).each do |comment| %>
                  <tr onClick="document.location = '/<%= @topic.permalink%>/comment_<%= comment.id %>';">
                    <% unless session[:user_id].nil? %>
                    <td width="10">
                      <% if @proxy.read_comments.find(comment.id) %>
                        <span class="label label-default"><i class="fa fa-check fa-fw"></i> </span>
                      <% else %>
                        <span class="label label-warning"><i class="fa fa-exclamation fa-fw"></i> </span>
                      <% end %>
                    </td>
                    <% end %>
                    <td><span class="text-<%= @comment.supporting.find(comment.id) ? "success" : "danger" %>"><%= @comment.supporting.find(comment.id) ? "支援" : "反駁" %></span>：<span class="text-default"><%= comment.display_abstract %></span></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="well well-sm">
      <h4 align="center" class="text-muted">評論受到的回應</h4>
      <% @replied = @comment.supported + @comment.opposed %>

      <div class="panel-body">

            <table class="table table-striped table-hover table-well">
              <tbody>
                <% @replied.sort!{|b,a| a.likes.count <=> b.likes.count}.first(10).each do |comment| %>
                  <tr onClick="document.location = '/<%= @topic.permalink%>/comment_<%= comment.id %>';">
                    <% unless session[:user_id].nil? %>
                    <td width="10">
                      <% if @proxy.read_comments.find(comment.id) %>
                        <span class="label label-default"><i class="fa fa-check fa-fw"></i> </span>
                      <% else %>
                        <span class="label label-warning"><i class="fa fa-exclamation fa-fw"></i> </span>
                      <% end %>
                    </td>
                    <% end %>
                    <td><span class="text-<%= @comment.supported.find(comment.id) ? "success" : "danger" %>"><%= @comment.supported.find(comment.id) ? "支援" : "反駁" %></span>：<span class="text-default"><%= comment.display_abstract %></span></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
      </div>
    </div>
  </div>
</div>